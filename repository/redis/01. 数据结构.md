## 一、Redis 有哪些“官方”数据结构？

Redis 常说的 **8 种核心数据结构**（按你日常使用频率排序）：

1. **String**
2. **Hash**
3. **List**
4. **Set**
5. **ZSet（Sorted Set）**
6. **Bitmap**
7. **HyperLogLog**
8. **Stream**

---

## 二、每种数据结构是什么、解决什么问题

### 1️⃣ String（最基础、最重要）

**本质**：`key -> 二进制安全的值`

```redis
SET key value
GET key
INCR key
```

#### 特点

* 最大 512MB
* 可以是：

  * 字符串
  * 数字
  * 序列化对象
* 支持原子自增、自减

#### 常见用途

* 缓存对象（JSON / protobuf）
* 计数器（PV、UV）
* 分布式锁（SET NX EX）
* token / session

**一句话**：

> Redis 的“万能起点”，90% 的业务离不开它。

---

### 2️⃣ Hash（对象 / 结构体）

**本质**：`key -> field -> value`

```redis
HSET user:1 name tom age 18
HGET user:1 name
```

#### 特点

* 非常适合“小对象”
* Field 级别更新，不需要整对象覆盖
* 内存效率高（小 hash 有特殊编码）

#### 常见用途

* 用户信息
* 配置项
* 订单状态
* 业务模型属性

**经验**：

> 只要你在 Java 里会写 POJO，这个结构就该想到 Hash。

---

### 3️⃣ List（双向链表）

```redis
LPUSH key v1
RPUSH key v2
LPOP key
```

#### 特点

* 有序
* 允许重复
* 支持阻塞操作（BLPOP）

#### 常见用途

* 消息队列（简单场景）
* 任务队列
* 最新列表（timeline）

#### 注意

* 不适合随机访问
* 不适合复杂消费确认

**一句话**：

> 能用，但不要把它当 Kafka。

---

### 4️⃣ Set（无序集合）

```redis
SADD key a b c
SISMEMBER key a
```

#### 特点

* 去重
* 无序
* 支持集合运算（交、并、差）

#### 常见用途

* 去重
* 标签系统
* 黑白名单
* 在线用户集合

**工程判断**：

> “要不要去重？”
> 是 → Set

---

### 5️⃣ ZSet（Sorted Set，含金量最高）

```redis
ZADD key score member
ZRANGE key 0 -1 WITHSCORES
```

#### 特点

* 有序
* 去重
* score 可重复
* 按 score 排序

#### 常见用途

* 排行榜
* 延迟队列
* 滑动窗口限流
* 定时任务
* 权重排序

**前面的限流，本质就是 ZSet 的典型用法。**

---

### 6️⃣ Bitmap（位图）

**本质**：基于 String 的 bit 操作

```redis
SETBIT key 10086 1
GETBIT key 10086
```

#### 特点

* 极省内存
* 位级操作
* 支持 AND / OR / XOR

#### 常见用途

* 签到
* 活跃用户统计
* 是否做过某事（yes/no）

**经验**：

> 百万用户的“是否”问题，Bitmap 是神器。

---

### 7️⃣ HyperLogLog（基数统计）

```redis
PFADD key user1 user2
PFCOUNT key
```

#### 特点

* 估算去重数量
* 极小内存（固定 ~12KB）
* 有误差（~0.81%）

#### 常见用途

* UV
* DAU
* 去重用户规模统计

**工程判断**：

> 要“准到个位数”？别用
> 要“趋势和规模”？必用

---

### 8️⃣ Stream（Redis 消息流）

```redis
XADD stream * field value
XREAD GROUP g c STREAMS stream >
```

#### 特点

* 持久化
* 消费组
* ACK 机制
* 有 offset

#### 常见用途

* 消息队列
* 异步任务
* 事件流

#### 注意

* 功能接近 MQ
* 生态、运维不如 Kafka 成熟

**一句话**：

> Redis 里“最不像 Redis”的结构。

---

## 三、一个非常重要但很多人忽略的点

### Redis 的“数据结构” ≠ 底层实现

比如：

| 对外结构   | 底层可能是               |
| ------ | ------------------- |
| String | SDS                 |
| Hash   | ziplist / hashtable |
| ZSet   | ziplist / skiplist  |
| List   | quicklist           |

👉 **Redis 会根据数据量自动切换编码**
你不需要手动管，但要知道它为什么快、什么时候变慢。

---

## 四、在工程里怎么选？（决策速查表）

| 需求   | 结构             |
| ---- | -------------- |
| 计数   | String         |
| 对象   | Hash           |
| 排序   | ZSet           |
| 去重   | Set            |
| 排行榜  | ZSet           |
| 延迟执行 | ZSet           |
| 是否状态 | Bitmap         |
| UV   | HyperLogLog    |
| MQ   | Stream（或外部 MQ） |

---

## 五、建议

你做 **交易 / 行情 / 风控系统**：

* **90%**：String / Hash / ZSet
* List / Stream：慎用
* Bitmap / HLL：用在统计、风控侧，非常香
